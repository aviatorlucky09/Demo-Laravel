(function(e){e.fn.ajaxSubmit=function(t){function h(){function p(){if(c++)return;u.detachEvent?u.detachEvent("onload",p):u.removeEventListener("load",p,false);var t=true;try{if(h)throw"timeout";var n,i;i=u.contentWindow?u.contentWindow.document:u.contentDocument?u.contentDocument:u.document;f.responseText=i.body?i.body.innerHTML:null;f.responseXML=i.XMLDocument?i.XMLDocument:i;f.getResponseHeader=function(e){var t={"content-type":r.dataType};return t[e]};if(r.dataType=="json"||r.dataType=="script"){var o=i.getElementsByTagName("textarea")[0];f.responseText=o?o.value:f.responseText}else if(r.dataType=="xml"&&!f.responseXML&&f.responseText!=null){f.responseXML=d(f.responseText)}n=e.httpData(f,r.dataType)}catch(a){t=false;e.handleError(r,f,"error",a)}if(t){r.success(n,"success");if(l)e.event.trigger("ajaxSuccess",[f,r])}if(l)e.event.trigger("ajaxComplete",[f,r]);if(l&&!--e.active)e.event.trigger("ajaxStop");if(r.complete)r.complete(f,t?"success":"error");setTimeout(function(){s.remove();f.responseXML=null},100)}function d(e,t){if(window.ActiveXObject){t=new ActiveXObject("Microsoft.XMLDOM");t.async="false";t.loadXML(e)}else t=(new DOMParser).parseFromString(e,"text/xml");return t&&t.documentElement&&t.documentElement.tagName!="parsererror"?t:null}var n=o[0];var r=e.extend({},e.ajaxSettings,t);var i="jqFormIO"+(new Date).getTime();var s=e('<iframe id="'+i+'" name="'+i+'" />');var u=s[0];var a=e.browser.opera&&window.opera.version()<9;if(e.browser.msie||a)u.src='javascript:false;document.write("");';s.css({position:"absolute",top:"-1000px",left:"-1000px"});var f={responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){}};var l=r.global;if(l&&!(e.active++))e.event.trigger("ajaxStart");if(l)e.event.trigger("ajaxSend",[f,r]);var c=0;var h=0;setTimeout(function(){var a=o.attr("target"),f=o.attr("action");o.attr({target:i,encoding:"multipart/form-data",enctype:"multipart/form-data",method:"POST",action:r.url});if(r.timeout)setTimeout(function(){h=true;p()},r.timeout);var l=[];try{if(t.extraData)for(var c in t.extraData)l.push(e('<input type="hidden" name="'+c+'" value="'+t.extraData[c]+'" />').appendTo(n)[0]);s.appendTo("body");u.attachEvent?u.attachEvent("onload",p):u.addEventListener("load",p,false);n.submit()}finally{o.attr("action",f);a?o.attr("target",a):o.removeAttr("target");e(l).remove()}},10);}if(typeof t=="function")t={success:t};t=e.extend({url:this.attr("action")||window.location.toString(),type:this.attr("method")||"GET"},t||{});var n={};this.trigger("form-pre-serialize",[this,t,n]);if(n.veto)return this;var r=this.formToArray(t.semantic);if(t.data){t.extraData=t.data;for(var i in t.data)r.push({name:i,value:t.data[i]})}if(t.beforeSubmit&&t.beforeSubmit(r,this,t)===false)return this;this.trigger("form-submit-validate",[r,this,t,n]);if(n.veto)return this;var s=e.param(r);if(t.type.toUpperCase()=="GET"){t.url+=(t.url.indexOf("?")>=0?"&":"?")+s;t.data=null}else t.data=s;var o=this,u=[];if(t.resetForm)u.push(function(){o.resetForm()});if(t.clearForm)u.push(function(){o.clearForm()});if(!t.dataType&&t.target){var a=t.success||function(){};u.push(function(n){e(t.target).html(n).each(a,arguments)})}else if(t.success)u.push(t.success);t.success=function(e,t){for(var n=0,r=u.length;n<r;n++)u[n](e,t,o)};var f=e("input:file",this).fieldValue();var l=false;for(var c=0;c<f.length;c++)if(f[c])l=true;if(t.iframe||l){if(e.browser.safari&&t.closeKeepAlive)e.get(t.closeKeepAlive,h);else h()}else e.ajax(t);this.trigger("form-submit-notify",[this,t]);return this;};e.fn.ajaxForm=function(t){return this.ajaxFormUnbind().bind("submit.form-plugin",function(){e(this).ajaxSubmit(t);return false}).each(function(){e(":submit,input:image",this).bind("click.form-plugin",function(t){var n=this.form;n.clk=this;if(this.type=="image"){if(t.offsetX!=undefined){n.clk_x=t.offsetX;n.clk_y=t.offsetY}else if(typeof e.fn.offset=="function"){var r=e(this).offset();n.clk_x=t.pageX-r.left;n.clk_y=t.pageY-r.top}else{n.clk_x=t.pageX-this.offsetLeft;n.clk_y=t.pageY-this.offsetTop}}setTimeout(function(){n.clk=n.clk_x=n.clk_y=null},10)})})};e.fn.ajaxFormUnbind=function(){this.unbind("submit.form-plugin");return this.each(function(){e(":submit,input:image",this).unbind("click.form-plugin")})};e.fn.formToArray=function(t){var n=[];if(this.length==0)return n;var r=this[0];var i=t?r.getElementsByTagName("*"):r.elements;if(!i)return n;for(var s=0,o=i.length;s<o;s++){var u=i[s];var a=u.name;if(!a)continue;if(t&&r.clk&&u.type=="image"){if(!u.disabled&&r.clk==u)n.push({name:a+".x",value:r.clk_x},{name:a+".y",value:r.clk_y});continue}var f=e.fieldValue(u,true);if(f&&f.constructor==Array){for(var l=0,c=f.length;l<c;l++)n.push({name:a,value:f[l]})}else if(f!==null&&typeof f!="undefined")n.push({name:a,value:f})}if(!t&&r.clk){var h=r.getElementsByTagName("input");for(var s=0,o=h.length;s<o;s++){var p=h[s];var a=p.name;if(a&&!p.disabled&&p.type=="image"&&r.clk==p)n.push({name:a+".x",value:r.clk_x},{name:a+".y",value:r.clk_y})}}return n};e.fn.formSerialize=function(t){return e.param(this.formToArray(t))};e.fn.fieldSerialize=function(t){var n=[];this.each(function(){var r=this.name;if(!r)return;var i=e.fieldValue(this,t);if(i&&i.constructor==Array){for(var s=0,o=i.length;s<o;s++)n.push({name:r,value:i[s]})}else if(i!==null&&typeof i!="undefined")n.push({name:this.name,value:i})});return e.param(n)};e.fn.fieldValue=function(t){for(var n=[],r=0,i=this.length;r<i;r++){var s=this[r];var o=e.fieldValue(s,t);if(o===null||typeof o=="undefined"||o.constructor==Array&&!o.length)continue;o.constructor==Array?e.merge(n,o):n.push(o)}return n};e.fieldValue=function(t,n){var r=t.name,i=t.type,s=t.tagName.toLowerCase();if(typeof n=="undefined")n=true;if(n&&(!r||t.disabled||i=="reset"||i=="button"||(i=="checkbox"||i=="radio")&&!t.checked||(i=="submit"||i=="image")&&t.form&&t.form.clk!=t||s=="select"&&t.selectedIndex==-1))return null;if(s=="select"){var o=t.selectedIndex;if(o<0)return null;var u=[],a=t.options;var f=i=="select-one";var l=f?o+1:a.length;for(var c=f?o:0;c<l;c++){var h=a[c];if(h.selected){var p=e.browser.msie&&!h.attributes["value"].specified?h.text:h.value;if(f)return p;u.push(p)}}return u}return t.value};e.fn.clearForm=function(){return this.each(function(){e("input,select,textarea",this).clearFields()})};e.fn.clearFields=e.fn.clearInputs=function(){return this.each(function(){var e=this.type,t=this.tagName.toLowerCase();if(e=="text"||e=="password"||t=="textarea")this.value="";else if(e=="checkbox"||e=="radio")this.checked=false;else if(t=="select")this.selectedIndex=-1})};e.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)this.reset()})};e.fn.enable=function(e){if(e==undefined)e=true;return this.each(function(){this.disabled=!e})};e.fn.select=function(t){if(t==undefined)t=true;return this.each(function(){var n=this.type;if(n=="checkbox"||n=="radio")this.checked=t;else if(this.tagName.toLowerCase()=="option"){var r=e(this).parent("select");if(t&&r[0]&&r[0].type=="select-one"){r.find("option").select(false)}this.selected=t}})}})(jQuery)